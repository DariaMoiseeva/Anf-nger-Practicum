---
title: "Q6"
author: "Tangqian Zhou 12626391"
date: "2023-11-14"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
library(readxl)
data <- read_excel("MUE.2022.for.LMU.xlsx")
data1<- data%>%select(class, E002)
data2<-data1%>%filter(!E002%in%c('-2','-9'))
data2$class <- case_when(
  data2$class == "GroÃŸunternehmen" ~ "1",
  data2$class == "Mittlere Unternehmen" ~ "2",
  data2$class == "Kleine Unternehmen" ~ "3",
  TRUE ~ "Other"
  )
data2$class<-as.factor(data2$class)
data2$E002<-factor(data2$E002)
data2<-na.omit(data2)
data2
head(data2)
library(tidyr)
library(ggplot2)
library(dplyr)
library(tidyverse)
data2 <- data2 %>% 
  group_by(class, E002) %>%
  summarise(Count = n()) %>%
  ungroup() %>%
  mutate(Percentage = Count / sum(Count) )
data2
model <- lm(Percentage ~ poly(as.numeric(E002), 2, raw = TRUE) + class, data = data2)
prediction_data <- expand.grid(class = unique(data2$class), E002 = unique(data2$E002))
prediction_data$Percentage <- predict(model, newdata = prediction_data)
prediction_data
ggplot(data2, aes(x = class, y = Percentage, color = factor(E002))) +
  geom_point(position = position_dodge(width = 0.5)) +
  geom_line(data = prediction_data, aes(group = E002, color = factor(E002)), size = 1) +
  labs(title = "Predictions of frequencies of corporate volunteering events based on ompany size ",
       x = "Company size",
       y = "Percentage",
       color="Frequency") +
  theme_minimal()
```
```{r}
library(readxl)
data <- read_excel("MUE.2022.for.LMU.xlsx")
data1<- data%>%select(A003, E002)
data2<-data1%>%filter(!E002%in%c('-2','-9'))
data3<-data2%>%filter(A003!=-9)
data3$A003<-as.factor(data3$A003)
data3$E002<-factor(data3$E002)
data3<-na.omit(data3)
data3
head(data3)
library(tidyr)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(dplyr)
data3 <- data3 %>%
  group_by(A003, E002) %>%
  summarise(Count = n()) %>%
  ungroup() %>%
  mutate(Percentage = Count / sum(Count) * 100)
data3<-na.omit(data3)
data3
model <- lm(Percentage ~ poly(as.numeric(E002), 2, raw = TRUE) + A003, data = data3)
prediction_data <- expand.grid(A003 = unique(data3$A003), E002 = unique(data3$E002))
prediction_data$Percentage <- predict(model, newdata = prediction_data)
prediction_data
ggplot(data3, aes(x = A003, y = Percentage, color = factor(E002))) +
  geom_point(position = position_dodge(width = 0.5)) +
  geom_line(data = prediction_data, aes(group = E002, color = factor(E002)), size = 1) +
  labs(title = "Predictions of frequencies of corporate volunteering events based on industry type",
       x = "Industry Type",
       y = "Percentage",
       color = "Frequency") +
  theme_minimal()
```

